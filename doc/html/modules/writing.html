
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>How to Write an Eggdrop Module &#8212; Eggdrop 1.9.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/eggdrop.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Eggdrop Bind Internals" href="internals.html" />
    <link rel="prev" title="Uptime Module" href="mod/uptime.html" /> 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../index.html">Eggdrop 1.9.5 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="mod/uptime.html" title="Uptime Module"
             accesskey="P">previous</a> |
          <a href="internals.html" title="Eggdrop Bind Internals"
             accesskey="N">next</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="sidebar">
          
          <h3>Table of Contents</h3>
          <p class="caption" role="heading"><span class="caption-text">Installing Eggdrop</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/readme.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install.html">Installing Eggdrop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/upgrading.html">Upgrading Eggdrop</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using Eggdrop</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../using/features.html">Eggdrop Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/core.html">Eggdrop Core Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/partyline.html">The Party Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/users.html">Users and Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/bans.html">Bans, Invites, and Exempts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/botnet.html">Botnet Sharing and Linking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/ipv6.html">IPv6 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/tls.html">TLS support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/ircv3.html">IRCv3 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/accounts.html">Account tracking in Eggdrop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/pbkdf2info.html">Encryption/Hashing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/twitchinfo.html">Twitch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/tricks.html">Advanced Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/text-sub.html">Textfile Substitutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/tcl-commands.html">Eggdrop Tcl Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/twitch-tcl-commands.html">Eggdrop Twitch Tcl Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/patch.html">Patching Eggdrop</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/setup.html">Setting Up Eggdrop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/firststeps.html">Common First Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tlssetup.html">Enabling TLS Security on Eggdrop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/firstscript.html">Writing an Eggdrop Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/module.html">Writing a Basic Eggdrop Module</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Eggdrop Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Eggdrop Module Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="included.html">Modules included with Eggdrop</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to Write an Eggdrop Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-requirements">Module requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-to-do-with-a-module">What to do with a module?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Eggdrop Bind Internals</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About Eggdrop</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/about.html">About Eggdrop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/legal.html">Boring legal stuff</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
            </form>
          </div>

        </div>
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="how-to-write-an-eggdrop-module">
<span id="writing-module"></span><h1>How to Write an Eggdrop Module<a class="headerlink" href="#how-to-write-an-eggdrop-module" title="Permalink to this heading">¶</a></h1>
<p>Note: This is for a simple module of 1 source file.</p>
<blockquote>
<div><ol class="arabic">
<li><p>Create a src/mod/MODULE.mod directory in your Eggdrop directory (where
MODULE is the module name) and cd to it.</p></li>
<li><p>Copy the file ‘Makefile’ from src/mod/woobie.mod and replace all
occurrences of ‘woobie’ with your module name. This should ensure
that your module gets compiled.</p></li>
<li><p>Next, you want to create a file called MODULE.c (MODULE is the module
name again).</p></li>
<li><p>You MUST include the following in your source code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define MODULE_NAME &quot;module-name&quot;</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>This should be defined to the same name you will be using when you load
your module.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define MAKING_MODULENAME</span>
</pre></div>
</div>
<p>MODULENAME is the name of your module (MODULE_NAME), but in all caps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;../module.h&quot;</span>
</pre></div>
</div>
<p>This provides access to Eggdrop’s global function table. Examine
src/mod/module.h closely to find a list of functions available.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include any other standard c header files you might need.</span>
</pre></div>
</div>
<p>Note that stdio.h, string.h, stdlib.h, and sys/types.h are already included.</p>
<p>Note that stdio.h, string.h, stdlib.h, and sys/types.h are already included.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Function</span> <span class="o">*</span><span class="k">global</span><span class="p">;</span>
</pre></div>
</div>
<p>This variable provides access to all the Eggdrop functions; without it,
you can’t call any Eggdrop functions (the module won’t even load).</p>
</div></blockquote>
</div></blockquote>
<section id="module-requirements">
<h2>Module requirements<a class="headerlink" href="#module-requirements" title="Permalink to this heading">¶</a></h2>
<p>In most modules, all functions/variables (except global and MODULE_start)
should be static. This will drastically reduce the size of modules on
decent systems.</p>
<dl class="simple">
<dt>Throughout this step, MODULE refers to the module name. Note that</dt><dd><p>“MODULE_NAME” should literally be “MODULE_NAME”.</p>
</dd>
</dl>
<section id="module-start">
<h3>MODULE_start<a class="headerlink" href="#module-start" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">char</span> <span class="o">*</span><span class="n">MODULE_start</span><span class="p">(</span><span class="n">Function</span> <span class="o">*</span><span class="n">func_table</span><span class="p">)</span>

<span class="n">This</span> <span class="n">function</span> <span class="ow">is</span> <span class="n">called</span> <span class="n">when</span> <span class="n">the</span> <span class="n">module</span> <span class="ow">is</span> <span class="n">first</span> <span class="n">loaded</span><span class="o">.</span> <span class="n">There</span> <span class="n">are</span>
<span class="n">several</span> <span class="n">things</span> <span class="n">that</span> <span class="n">need</span> <span class="n">to</span> <span class="n">be</span> <span class="n">done</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">function</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">global</span> <span class="o">=</span> <span class="n">func_table</span><span class="p">;</span>

<span class="n">This</span> <span class="n">allows</span> <span class="n">you</span> <span class="n">to</span> <span class="n">make</span> <span class="n">calls</span> <span class="n">to</span> <span class="n">the</span> <span class="k">global</span> <span class="n">function</span> <span class="n">table</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module_register</span><span class="p">(</span><span class="n">MODULE_NAME</span><span class="p">,</span> <span class="n">MODULE_table</span><span class="p">,</span> <span class="n">MAJOR</span><span class="p">,</span> <span class="n">MINOR</span><span class="p">);</span>

<span class="n">This</span> <span class="n">records</span> <span class="n">details</span> <span class="n">about</span> <span class="n">the</span> <span class="n">module</span> <span class="k">for</span> <span class="n">other</span> <span class="n">modules</span> <span class="ow">and</span> <span class="n">Eggdrop</span>
<span class="n">itself</span> <span class="n">to</span> <span class="n">access</span><span class="o">.</span> <span class="n">MAJOR</span> <span class="ow">and</span> <span class="n">MINOR</span> <span class="n">are</span> <span class="n">ints</span><span class="p">,</span> <span class="n">where</span> <span class="n">MAJOR</span> <span class="ow">is</span> <span class="n">the</span>
<span class="n">module</span><span class="s1">&#39;s major version number and MINOR is a minor version number.</span>
<span class="n">MODULE_table</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">function</span> <span class="n">table</span> <span class="p">(</span><span class="n">see</span> <span class="n">below</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module_depend</span><span class="p">(</span><span class="n">MODULE_NAME</span><span class="p">,</span> <span class="s2">&quot;another-module&quot;</span><span class="p">,</span> <span class="n">MAJOR</span><span class="p">,</span> <span class="n">MINOR</span><span class="p">);</span>

<span class="n">This</span> <span class="n">lets</span> <span class="n">Eggdrop</span> <span class="n">know</span> <span class="n">that</span> <span class="n">your</span> <span class="n">module</span> <span class="n">NEEDS</span> <span class="s2">&quot;another-module&quot;</span> <span class="n">of</span>
<span class="n">major</span> <span class="n">version</span> <span class="s1">&#39;MAJOR&#39;</span> <span class="ow">and</span> <span class="n">at</span> <span class="n">least</span> <span class="n">minor</span> <span class="n">version</span> <span class="s1">&#39;MINOR&#39;</span> <span class="n">to</span> <span class="n">run</span><span class="p">,</span>
<span class="ow">and</span> <span class="n">hence</span> <span class="n">should</span> <span class="k">try</span> <span class="n">to</span> <span class="n">load</span> <span class="n">it</span> <span class="k">if</span> <span class="n">it</span><span class="s1">&#39;s not already loaded. This</span>
<span class="n">will</span> <span class="k">return</span> <span class="mi">1</span> <span class="n">on</span> <span class="n">success</span><span class="p">,</span> <span class="ow">or</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">it</span> <span class="n">can</span><span class="s1">&#39;t be done (at which stage</span>
<span class="n">you</span> <span class="n">should</span> <span class="k">return</span> <span class="n">an</span> <span class="n">error</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<p>Any other initialization stuff you desire should also be included in
this function. See below for various things you can do.</p>
<p>You also will need to return a value. Returning NULL implies the
module loaded successfully. Returning a non-NULL STRING is an error
message. The module (and any other dependent modules) will stop
loading and an error will be returned.</p>
</section>
<section id="module-table">
<h3>MODULE_table<a class="headerlink" href="#module-table" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">Function</span> <span class="o">*</span><span class="n">MODULE_table</span> <span class="o">=</span> <span class="p">{</span>
       <span class="n">MODULE_start</span><span class="p">,</span>
       <span class="n">MODULE_close</span><span class="p">,</span>
       <span class="n">MODULE_expmem</span><span class="p">,</span>
       <span class="n">MODULE_report</span><span class="p">,</span>
       <span class="n">any_other_functions</span><span class="p">,</span>
       <span class="n">you_want_to_export</span>
<span class="p">};</span>

<span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">table</span> <span class="n">of</span> <span class="n">functions</span> <span class="n">which</span> <span class="nb">any</span> <span class="n">other</span> <span class="n">module</span> <span class="n">can</span> <span class="n">access</span><span class="o">.</span> <span class="n">The</span>
<span class="n">first</span> <span class="mi">4</span> <span class="n">functions</span> <span class="n">are</span> <span class="n">FIXED</span><span class="o">.</span> <span class="n">You</span> <span class="n">MUST</span> <span class="n">have</span> <span class="n">them</span><span class="p">;</span> <span class="n">they</span> <span class="n">provide</span> <span class="n">important</span>
<span class="n">module</span> <span class="n">information</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="module-close">
<h3>MODULE_close ()<a class="headerlink" href="#module-close" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">char</span> <span class="o">*</span><span class="n">MODULE_close</span> <span class="p">()</span>

<span class="n">This</span> <span class="ow">is</span> <span class="n">called</span> <span class="n">when</span> <span class="n">the</span> <span class="n">module</span> <span class="ow">is</span> <span class="n">unloaded</span><span class="o">.</span> <span class="n">Apart</span> <span class="kn">from</span> <span class="nn">tidying</span> <span class="nb">any</span>
<span class="n">relevant</span> <span class="n">data</span> <span class="p">(</span><span class="n">I</span> <span class="n">suggest</span> <span class="n">you</span> <span class="n">be</span> <span class="n">thorough</span><span class="p">,</span> <span class="n">we</span> <span class="n">don</span><span class="s1">&#39;t want any trailing</span>
<span class="n">garbage</span> <span class="kn">from</span> <span class="nn">modules</span><span class="p">),</span> <span class="n">you</span> <span class="n">MUST</span> <span class="n">do</span> <span class="n">the</span> <span class="n">following</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module_undepend</span><span class="p">(</span><span class="n">MODULE_NAME</span><span class="p">);</span>

<span class="n">This</span> <span class="n">lets</span> <span class="n">Eggdrop</span> <span class="n">know</span> <span class="n">your</span> <span class="n">module</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">depends</span> <span class="n">on</span> <span class="nb">any</span> <span class="n">other</span>
<span class="n">modules</span><span class="o">.</span>

<span class="n">Return</span> <span class="n">a</span> <span class="n">value</span><span class="o">.</span> <span class="n">NULL</span> <span class="n">implies</span> <span class="n">success</span><span class="p">;</span> <span class="nb">any</span> <span class="n">non</span><span class="o">-</span><span class="n">NULL</span> <span class="n">STRING</span> <span class="n">implies</span>
<span class="n">that</span> <span class="n">the</span> <span class="n">module</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">unloaded</span> <span class="k">for</span> <span class="n">some</span> <span class="n">reason</span><span class="p">,</span> <span class="ow">and</span> <span class="n">hence</span> <span class="n">the</span>
<span class="n">bot</span> <span class="n">should</span> <span class="ow">not</span> <span class="n">unload</span> <span class="n">it</span> <span class="p">(</span><span class="n">see</span> <span class="n">the</span> <span class="n">blowfish</span> <span class="n">module</span> <span class="k">for</span> <span class="n">an</span> <span class="n">example</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="module-expmem">
<h3>MODULE_expmem<a class="headerlink" href="#module-expmem" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="nb">int</span> <span class="n">MODULE_expmem</span> <span class="p">()</span>

<span class="n">This</span> <span class="n">should</span> <span class="n">tally</span> <span class="nb">all</span> <span class="n">memory</span> <span class="n">you</span> <span class="n">allocate</span><span class="o">/</span><span class="n">deallocate</span> <span class="n">within</span> <span class="n">the</span> <span class="n">module</span>
<span class="p">(</span><span class="n">using</span> <span class="n">nmalloc</span><span class="p">,</span> <span class="n">nfree</span><span class="p">,</span> <span class="n">etc</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">bytes</span><span class="o">.</span> <span class="n">It</span><span class="s1">&#39;s used by memory debugging to</span>
<span class="n">track</span> <span class="n">memory</span> <span class="n">faults</span><span class="p">,</span> <span class="ow">and</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">by</span> <span class="o">.</span><span class="n">status</span> <span class="n">to</span> <span class="n">total</span> <span class="n">up</span> <span class="n">memory</span> <span class="n">usage</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="module-report">
<h3>MODULE_report<a class="headerlink" href="#module-report" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">void</span> <span class="n">MODULE_report</span> <span class="p">(</span><span class="nb">int</span> <span class="n">idx</span><span class="p">)</span>

<span class="n">This</span> <span class="n">should</span> <span class="n">provide</span> <span class="n">a</span> <span class="n">relatively</span> <span class="n">short</span> <span class="n">report</span> <span class="n">of</span> <span class="n">the</span> <span class="n">module</span><span class="s1">&#39;s status</span>
<span class="p">(</span><span class="k">for</span> <span class="n">the</span> <span class="n">module</span> <span class="ow">and</span> <span class="n">status</span> <span class="n">commands</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<p>These functions are available to modules. MANY more available functions
can be found in src/mod/module.h.</p>
</section>
<section id="additional-functions">
<h3>Additional functions<a class="headerlink" href="#additional-functions" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="o">*</span><span class="n">nmalloc</span><span class="p">(</span><span class="nb">int</span> <span class="n">j</span><span class="p">);</span>

<span class="n">This</span> <span class="n">allocates</span> <span class="n">j</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">memory</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">nfree</span><span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>

<span class="n">This</span> <span class="n">frees</span> <span class="n">an</span> <span class="n">nmalloc</span><span class="s1">&#39;d block of memory.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Context</span><span class="p">;</span>

<span class="n">Actually</span> <span class="n">a</span> <span class="n">macro</span> <span class="o">--</span> <span class="n">records</span> <span class="n">the</span> <span class="n">current</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">execution</span> <span class="p">(</span><span class="k">for</span>
<span class="n">debugging</span><span class="p">)</span><span class="o">.</span> <span class="n">Using</span> <span class="n">Context</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">recommended</span><span class="p">,</span> <span class="n">because</span> <span class="n">it</span> <span class="n">uses</span>
<span class="n">too</span> <span class="n">many</span> <span class="n">resources</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">core</span> <span class="n">file</span> <span class="n">provides</span> <span class="n">much</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">dprintf</span><span class="p">(</span><span class="nb">int</span> <span class="n">idx</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="nb">format</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="n">This</span> <span class="n">acts</span> <span class="n">like</span> <span class="n">a</span> <span class="n">normal</span> <span class="n">printf</span><span class="p">()</span> <span class="n">function</span><span class="p">,</span> <span class="n">but</span> <span class="n">it</span> <span class="n">outputs</span> <span class="n">to</span>
<span class="n">log</span><span class="o">/</span><span class="n">socket</span><span class="o">/</span><span class="n">idx</span><span class="o">.</span>

<span class="n">idx</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">normal</span> <span class="n">dcc</span> <span class="n">idx</span><span class="p">,</span> <span class="ow">or</span> <span class="k">if</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">sock</span> <span class="n">number</span><span class="o">.</span>

<span class="n">Other</span> <span class="n">destinations</span><span class="p">:</span>
  <span class="n">DP_LOG</span>    <span class="o">-</span> <span class="n">send</span> <span class="n">to</span> <span class="n">log</span> <span class="n">file</span>
  <span class="n">DP_STDOUT</span> <span class="o">-</span> <span class="n">send</span> <span class="n">to</span> <span class="n">stdout</span>
  <span class="n">DP_MODE</span>   <span class="o">-</span> <span class="n">send</span> <span class="n">via</span> <span class="n">mode</span> <span class="n">queue</span> <span class="n">to</span> <span class="n">the</span> <span class="n">server</span>
  <span class="n">DP_SERVER</span> <span class="o">-</span> <span class="n">send</span> <span class="n">via</span> <span class="n">normal</span> <span class="n">queue</span> <span class="n">to</span> <span class="n">the</span> <span class="n">server</span>
  <span class="n">DP_HELP</span>   <span class="o">-</span> <span class="n">send</span> <span class="n">via</span> <span class="n">help</span> <span class="n">queue</span> <span class="n">to</span> <span class="n">server</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="n">module_entry</span> <span class="o">*</span><span class="n">module_find</span><span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="n">module_name</span><span class="p">,</span> <span class="nb">int</span> <span class="n">major</span><span class="p">,</span> <span class="nb">int</span> <span class="n">minor</span><span class="p">);</span>

  <span class="n">Searches</span> <span class="k">for</span> <span class="n">a</span> <span class="n">loaded</span> <span class="n">module</span> <span class="p">(</span><span class="n">matching</span> <span class="n">major</span><span class="p">,</span> <span class="o">&gt;=</span> <span class="n">minor</span><span class="p">),</span> <span class="ow">and</span> <span class="n">returns</span>
  <span class="n">info</span> <span class="n">about</span> <span class="n">it</span><span class="o">.</span>

  <span class="n">Members</span> <span class="n">of</span> <span class="n">module_entry</span><span class="p">:</span>
    <span class="n">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>      <span class="o">-</span> <span class="n">module</span> <span class="n">name</span>
    <span class="nb">int</span> <span class="n">major</span><span class="p">;</span>       <span class="o">-</span> <span class="n">real</span> <span class="n">major</span> <span class="n">version</span>
    <span class="nb">int</span> <span class="n">minor</span><span class="p">;</span>       <span class="o">-</span> <span class="n">real</span> <span class="n">minor</span> <span class="n">version</span>
    <span class="n">Function</span> <span class="o">*</span><span class="n">funcs</span><span class="p">;</span> <span class="o">-</span> <span class="n">function</span> <span class="n">table</span> <span class="p">(</span><span class="n">see</span> <span class="n">above</span><span class="p">)</span>

<span class="n">void</span> <span class="n">module_rename</span><span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="n">old_module_name</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">new_module_name</span><span class="p">)</span>

  <span class="n">This</span> <span class="n">renames</span> <span class="n">a</span> <span class="n">module</span> <span class="n">frim</span> <span class="n">old_module_name</span> <span class="n">to</span> <span class="n">new_module_name</span><span class="o">.</span>

<span class="n">void</span> <span class="n">add_hook</span><span class="p">(</span><span class="nb">int</span> <span class="n">hook_num</span><span class="p">,</span> <span class="n">Function</span> <span class="o">*</span><span class="n">funcs</span><span class="p">)</span>
<span class="n">void</span> <span class="n">del_hook</span><span class="p">(</span><span class="nb">int</span> <span class="n">hook_num</span><span class="p">,</span> <span class="n">Function</span> <span class="o">*</span><span class="n">funcs</span><span class="p">)</span>

 <span class="n">These</span> <span class="n">are</span> <span class="n">used</span> <span class="k">for</span> <span class="n">adding</span> <span class="ow">or</span> <span class="n">removing</span> <span class="n">hooks</span> <span class="n">to</span><span class="o">/</span><span class="kn">from</span> <span class="nn">Eggdrop</span> <span class="n">code</span> <span class="n">that</span>
 <span class="n">are</span> <span class="n">triggered</span> <span class="n">on</span> <span class="n">various</span> <span class="n">events</span><span class="o">.</span> <span class="n">Valid</span> <span class="n">hooks</span> <span class="n">are</span><span class="p">:</span>
   <span class="n">HOOK_SECONDLY</span>   <span class="o">-</span> <span class="n">called</span> <span class="n">every</span> <span class="n">second</span>
   <span class="n">HOOK_MINUTELY</span>   <span class="o">-</span> <span class="n">called</span> <span class="n">every</span> <span class="n">minute</span>
   <span class="n">HOOK_5MINUTELY</span>  <span class="o">-</span> <span class="n">called</span> <span class="n">every</span> <span class="mi">5</span> <span class="n">minutes</span>
   <span class="n">HOOK_HOURLY</span>     <span class="o">-</span> <span class="n">called</span> <span class="n">every</span> <span class="n">hour</span> <span class="p">(</span><span class="n">hourly</span><span class="o">-</span><span class="n">updates</span> <span class="n">minutes</span> <span class="n">past</span><span class="p">)</span>
   <span class="n">HOOK_DAILY</span>      <span class="o">-</span> <span class="n">called</span> <span class="n">when</span> <span class="n">the</span> <span class="n">logfiles</span> <span class="n">are</span> <span class="n">switched</span>

   <span class="n">HOOK_READ_USERFILE</span> <span class="o">-</span> <span class="n">called</span> <span class="n">when</span> <span class="n">the</span> <span class="n">userfile</span> <span class="ow">is</span> <span class="n">read</span>
   <span class="n">HOOK_USERFILE</span>      <span class="o">-</span> <span class="n">called</span> <span class="n">when</span> <span class="n">the</span> <span class="n">userfile</span> <span class="ow">is</span> <span class="n">written</span>
   <span class="n">HOOK_PRE_REHASH</span>    <span class="o">-</span> <span class="n">called</span> <span class="n">just</span> <span class="n">before</span> <span class="n">a</span> <span class="n">rehash</span>
   <span class="n">HOOK_REHASH</span>        <span class="o">-</span> <span class="n">called</span> <span class="n">just</span> <span class="n">after</span> <span class="n">a</span> <span class="n">rehash</span>
   <span class="n">HOOK_IDLE</span>          <span class="o">-</span> <span class="n">called</span> <span class="n">whenever</span> <span class="n">the</span> <span class="n">dcc</span> <span class="n">connections</span> <span class="n">have</span> <span class="n">been</span>
                        <span class="n">idle</span> <span class="k">for</span> <span class="n">a</span> <span class="n">whole</span> <span class="n">second</span>
   <span class="n">HOOK_BACKUP</span>        <span class="o">-</span> <span class="n">called</span> <span class="n">when</span> <span class="n">a</span> <span class="n">user</span><span class="o">/</span><span class="n">channel</span> <span class="n">file</span> <span class="n">backup</span> <span class="ow">is</span> <span class="n">done</span>
   <span class="n">HOOK_LOADED</span>        <span class="o">-</span> <span class="n">called</span> <span class="n">when</span> <span class="n">Eggdrop</span> <span class="ow">is</span> <span class="n">first</span> <span class="n">loaded</span>
   <span class="n">HOOK_DIE</span>           <span class="o">-</span> <span class="n">called</span> <span class="n">when</span> <span class="n">Eggdrop</span> <span class="ow">is</span> <span class="n">about</span> <span class="n">to</span> <span class="n">die</span>

<span class="n">char</span> <span class="o">*</span><span class="n">module_unload</span> <span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="n">module_name</span><span class="p">);</span>
<span class="n">char</span> <span class="o">*</span><span class="n">module_load</span> <span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="n">module_name</span><span class="p">);</span>

  <span class="n">Tries</span> <span class="n">to</span> <span class="n">load</span> <span class="ow">or</span> <span class="n">unload</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">module</span><span class="p">;</span> <span class="n">returns</span> <span class="mi">0</span> <span class="n">on</span> <span class="n">success</span><span class="p">,</span> <span class="ow">or</span>
  <span class="n">an</span> <span class="n">error</span> <span class="n">message</span><span class="o">.</span>

<span class="n">void</span> <span class="n">add_tcl_commands</span><span class="p">(</span><span class="n">tcl_cmds</span> <span class="o">*</span><span class="n">tab</span><span class="p">);</span>
<span class="n">void</span> <span class="n">rem_tcl_commands</span><span class="p">(</span><span class="n">tcl_cmds</span> <span class="o">*</span><span class="n">tab</span><span class="p">);</span>

  <span class="n">Provides</span> <span class="n">a</span> <span class="n">quick</span> <span class="n">way</span> <span class="n">to</span> <span class="n">create</span> <span class="ow">and</span> <span class="n">remove</span> <span class="n">a</span> <span class="n">table</span> <span class="n">of</span> <span class="n">Tcl</span> <span class="n">commands</span><span class="o">.</span> <span class="n">The</span>
  <span class="n">table</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">form</span> <span class="n">of</span><span class="p">:</span>

    <span class="p">{</span><span class="n">char</span> <span class="o">*</span><span class="n">func_name</span><span class="p">,</span> <span class="n">Function</span> <span class="o">*</span><span class="n">function_to_call</span><span class="p">}</span>

  <span class="n">Use</span> <span class="p">{</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span> <span class="p">}</span> <span class="n">to</span> <span class="n">indicate</span> <span class="n">the</span> <span class="n">end</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">list</span><span class="o">.</span>

<span class="n">void</span> <span class="n">add_tcl_ints</span><span class="p">(</span><span class="n">tcl_ints</span> <span class="o">*</span><span class="p">);</span>
<span class="n">void</span> <span class="n">rem_tcl_ints</span><span class="p">(</span><span class="n">tcl_ints</span> <span class="o">*</span><span class="p">);</span>

  <span class="n">Provides</span> <span class="n">a</span> <span class="n">quick</span> <span class="n">way</span> <span class="n">to</span> <span class="n">create</span> <span class="ow">and</span> <span class="n">remove</span> <span class="n">a</span> <span class="n">table</span> <span class="n">of</span> <span class="n">links</span> <span class="kn">from</span> <span class="nn">C</span>
  <span class="nb">int</span> <span class="n">variables</span> <span class="n">to</span> <span class="n">Tcl</span> <span class="n">variables</span> <span class="p">(</span><span class="n">add_tcl_ints</span> <span class="n">checks</span> <span class="n">to</span> <span class="n">see</span> <span class="k">if</span> <span class="n">the</span> <span class="n">Tcl</span>
  <span class="n">variable</span> <span class="n">exists</span> <span class="ow">and</span> <span class="n">copies</span> <span class="n">it</span> <span class="n">over</span> <span class="n">the</span> <span class="n">C</span> <span class="n">one</span><span class="p">)</span><span class="o">.</span> <span class="n">The</span> <span class="nb">format</span> <span class="n">of</span> <span class="n">table</span> <span class="ow">is</span><span class="p">:</span>

    <span class="p">{</span><span class="n">char</span> <span class="o">*</span><span class="n">variable_name</span><span class="p">,</span> <span class="nb">int</span> <span class="o">*</span><span class="n">variable</span><span class="p">,</span> <span class="nb">int</span> <span class="n">readonly</span><span class="p">}</span>

  <span class="n">Use</span> <span class="p">{</span><span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">}</span> <span class="n">to</span> <span class="n">indicate</span> <span class="n">the</span> <span class="n">end</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">list</span><span class="o">.</span>

<span class="n">void</span> <span class="n">add_tcl_strings</span><span class="p">(</span><span class="n">tcl_strings</span> <span class="o">*</span><span class="p">);</span>
<span class="n">void</span> <span class="n">rem_tcl_strings</span><span class="p">(</span><span class="n">tcl_strings</span> <span class="o">*</span><span class="p">);</span>

  <span class="n">Provides</span> <span class="n">a</span> <span class="n">quick</span> <span class="n">way</span> <span class="n">to</span> <span class="n">create</span> <span class="ow">and</span> <span class="n">remove</span> <span class="n">a</span> <span class="n">table</span> <span class="n">of</span> <span class="n">links</span> <span class="kn">from</span> <span class="nn">C</span>
  <span class="n">string</span> <span class="n">variables</span> <span class="n">to</span> <span class="n">Tcl</span> <span class="n">variables</span> <span class="p">(</span><span class="n">add_tcl_ints</span> <span class="n">checks</span> <span class="n">to</span> <span class="n">see</span> <span class="k">if</span> <span class="n">the</span>
  <span class="n">Tcl</span> <span class="n">variable</span> <span class="n">exists</span> <span class="ow">and</span> <span class="n">copies</span> <span class="n">it</span> <span class="n">over</span> <span class="n">the</span> <span class="n">C</span> <span class="n">one</span><span class="p">)</span><span class="o">.</span> <span class="n">The</span> <span class="nb">format</span> <span class="n">of</span> <span class="n">table</span>
  <span class="ow">is</span><span class="p">:</span>

    <span class="p">{</span><span class="n">char</span> <span class="o">*</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">string</span><span class="p">,</span> <span class="nb">int</span> <span class="n">length</span><span class="p">,</span> <span class="nb">int</span> <span class="n">flags</span><span class="p">}</span>

  <span class="n">Use</span> <span class="p">{</span><span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">}</span> <span class="n">to</span> <span class="n">indicate</span> <span class="n">the</span> <span class="n">end</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">list</span><span class="o">.</span> <span class="n">Use</span> <span class="mi">0</span> <span class="k">for</span>
  <span class="n">length</span> <span class="k">if</span> <span class="n">you</span> <span class="n">want</span> <span class="n">a</span> <span class="n">const</span> <span class="n">string</span><span class="o">.</span> <span class="n">Use</span> <span class="n">STR_DIR</span> <span class="k">for</span> <span class="n">flags</span> <span class="k">if</span> <span class="n">you</span> <span class="n">want</span> <span class="n">a</span>
  <span class="s1">&#39;/&#39;</span> <span class="n">constantly</span> <span class="n">appended</span><span class="p">;</span> <span class="n">use</span> <span class="n">STR_PROTECT</span> <span class="k">if</span> <span class="n">you</span> <span class="n">want</span> <span class="n">the</span> <span class="n">variable</span> <span class="nb">set</span>
  <span class="ow">in</span> <span class="n">the</span> <span class="n">config</span> <span class="n">file</span><span class="p">,</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">during</span> <span class="n">normal</span> <span class="n">usage</span><span class="o">.</span>

<span class="n">void</span> <span class="n">add_builtins</span><span class="p">(</span><span class="n">p_tcl_hash_list</span> <span class="n">table</span><span class="p">,</span> <span class="n">cmd_t</span> <span class="o">*</span><span class="n">cc</span><span class="p">);</span>
<span class="n">void</span> <span class="n">rem_builtins</span><span class="p">(</span><span class="n">p_tcl_hash_list</span> <span class="n">table</span><span class="p">,</span> <span class="n">cmd_t</span> <span class="o">*</span><span class="n">cc</span><span class="p">);</span>

  <span class="n">This</span> <span class="n">adds</span> <span class="n">binds</span> <span class="n">to</span> <span class="n">one</span> <span class="n">of</span> <span class="n">Eggdrop</span><span class="s1">&#39;s bind tables. The format of the</span>
  <span class="n">table</span> <span class="ow">is</span><span class="p">:</span>

    <span class="p">{</span><span class="n">char</span> <span class="o">*</span><span class="n">command</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">Function</span> <span class="o">*</span><span class="n">function</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">displayname</span><span class="p">}</span>

  <span class="n">Use</span> <span class="p">{</span><span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">}</span> <span class="n">to</span> <span class="n">indicate</span> <span class="n">the</span> <span class="n">end</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">list</span><span class="o">.</span>

  <span class="n">This</span> <span class="n">works</span> <span class="n">EXACTLY</span> <span class="n">like</span> <span class="n">the</span> <span class="n">Tcl</span> <span class="s1">&#39;bind&#39;</span> <span class="n">command</span><span class="o">.</span> <span class="n">displayname</span> <span class="ow">is</span> <span class="n">what</span> <span class="n">Tcl</span>
  <span class="n">sees</span> <span class="n">this</span> <span class="n">function</span><span class="s1">&#39;s proc name as (in .binds all).</span>

  <span class="n">function</span> <span class="ow">is</span> <span class="n">called</span> <span class="k">with</span> <span class="n">exactly</span> <span class="n">the</span> <span class="n">same</span> <span class="n">args</span> <span class="k">as</span> <span class="n">a</span> <span class="n">Tcl</span> <span class="n">binding</span> <span class="ow">is</span> <span class="k">with</span>
  <span class="nb">type</span> <span class="n">conversion</span> <span class="n">taken</span> <span class="n">into</span> <span class="n">account</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">idx</span><span class="s1">&#39;s are ints). Return values</span>
  <span class="n">are</span> <span class="n">much</span> <span class="n">the</span> <span class="n">same</span> <span class="k">as</span> <span class="n">Tcl</span> <span class="n">bindings</span><span class="o">.</span> <span class="n">Use</span> <span class="nb">int</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span> <span class="k">for</span> <span class="n">those</span> <span class="n">which</span> <span class="n">require</span>
  <span class="mi">0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="ow">or</span> <span class="n">char</span> <span class="o">*</span> <span class="k">for</span> <span class="n">those</span> <span class="n">which</span> <span class="n">require</span> <span class="n">a</span> <span class="n">string</span> <span class="p">(</span><span class="n">auch</span> <span class="k">as</span> <span class="n">filt</span><span class="p">)</span><span class="o">.</span> <span class="n">Return</span>
  <span class="n">nothing</span> <span class="k">if</span> <span class="n">no</span> <span class="k">return</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">required</span><span class="o">.</span>

<span class="n">void</span> <span class="n">putlog</span> <span class="p">(</span><span class="nb">int</span> <span class="n">logmode</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">channel</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="nb">format</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

  <span class="n">Adds</span> <span class="n">text</span> <span class="n">to</span> <span class="n">a</span> <span class="n">logfile</span> <span class="p">(</span><span class="n">determined</span> <span class="n">by</span> <span class="n">logmode</span> <span class="ow">and</span> <span class="n">channel</span><span class="p">)</span><span class="o">.</span> <span class="n">This</span> <span class="n">text</span>
  <span class="n">will</span> <span class="n">also</span> <span class="n">output</span> <span class="n">to</span> <span class="nb">any</span> <span class="n">users</span><span class="s1">&#39; consoles if they have the specified</span>
  <span class="n">console</span> <span class="n">mode</span> <span class="n">enabled</span><span class="o">.</span>
</pre></div>
</div>
</section>
</section>
<section id="what-to-do-with-a-module">
<h2>What to do with a module?<a class="headerlink" href="#what-to-do-with-a-module" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p>If you have written a module and feel that you wish to share it with the
rest of the Eggdrop community, find us in #eggdrop on Libera. Make sure you
have a nice descriptive text (modulename.desc) to describe it, and make sure
to mention in your text file which version Eggdrop the module is written for.</p>
</div></blockquote>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="mod/uptime.html" title="Uptime Module"
              >previous</a> |
            <a href="internals.html" title="Eggdrop Bind Internals"
              >next</a>
          </div>
          <div role="note" aria-label="source link">
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Eggheads.
      Last updated on Mar 11, 2023.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>