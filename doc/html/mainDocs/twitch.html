
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Twitch &#8212; Eggdrop 1.9.0 documentation</title>
    <link rel="stylesheet" href="../_static/eggdrop.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
          <p class="logo"><a href="../index.html">
            <img class="logo" src="../_static/eggman.png.gif" alt="Logo"/>
          </a></p>
        <div class="headertitle"><a
          href="../index.html">Eggdrop 1.9.0 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="sidebar">
          
          <h3>Table of Contents</h3>
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../installAndSetup/readme.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installAndSetup/install.html">Installing Eggdrop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installAndSetup/faq.html">Frequently Asked Questions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">About Eggdrop</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Eggdrop Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="users.html">Users and Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="partyline.html">The Party Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="bans.html">Bans, Invites, and Exempts</a></li>
<li class="toctree-l1"><a class="reference internal" href="botnet.html">Botnet Sharing and Linking</a></li>
<li class="toctree-l1"><a class="reference internal" href="patch.html">Patch How-To</a></li>
<li class="toctree-l1"><a class="reference internal" href="tcl-commands.html">Eggdrop Tcl Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipv6.html">IPv6 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="tls.html">TLS support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/core.html">Eggdrop Core Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/modules.html">Eggdrop Module Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/assoc.html">Assoc Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/blowfish.html">Blowfish Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/channels.html">Channels Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/compress.html">Compress Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/console.html">Console Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/ctcp.html">CTCP Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/dns.html">DNS Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/filesys.html">Filesys Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/ident.html">Ident Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/irc.html">IRC Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/notes.html">Notes Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/seen.html">Seen Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/server.html">Server Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/share.html">Share Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/transfer.html">Transfer Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/uptime.html">Uptime Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreDocs/woobie.html">Woobie Module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendices/known-probs.html">Known Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/tricks.html">Eggdrop Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/text-sub.html">Textfile Substitutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/weird-msgs.html">Weird Messages That Get Logged</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/first-script.html">Your First Eggdrop Script</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
            </form>
          </div>

        </div>
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="twitch">
<h1>Twitch<a class="headerlink" href="#twitch" title="Permalink to this headline">¶</a></h1>
<p>This module <em>attempts</em> to provide connectivity with the Twitch gaming platform. While Twitch provides an IRC gateway to connect with it’s streaming service, it does not claim to (and certainly does not) follow the IRC RFC in any meaningful way. The intent of this module is not to provide the full spectrum of management functions typically associated with Eggdrop; instead it focuses around the following key functions:</p>
<ul class="simple">
<li>Logging of general and Twitch-specific events (raids, blocks, bit donations)</li>
<li>Tracking userstate and roomstate values</li>
<li>Adding Tcl event binds for a number of Twitch events</li>
</ul>
<div class="section" id="disclaimer">
<h2>Disclaimer<a class="headerlink" href="#disclaimer" title="Permalink to this headline">¶</a></h2>
<p>We should also make clear that Eggdrop is in no way affiliated with Twitch in any way, and Twitch fully controls their own platform, to include the IRC gateway. This was just a fun project implemented at the request of some users to interact with the Twitch IRC development gateway as it existed at the time of development. At any time, Twitch could choose to alter or discontinue their IRC connectivity, thereby rendering this Eggdrop module useless. Eggdrop developers are also unable to offer technical support for Twitch-specific issues encountered while using this module.</p>
</div>
<div class="section" id="registering-with-twitch">
<h2>Registering with Twitch<a class="headerlink" href="#registering-with-twitch" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Register an account with Twitch. At the time of writing, this is done by visiting <a class="reference external" href="http://twitch.tv/">Twitch</a> and clicking on the Sign Up button.</li>
<li>Generate a token to authenticate your bot with Twitch. At the time of writing, this is done by visiting the <a class="reference external" href="https://twitchapps.com/tmi/">Twitch OAuth generator</a> while logged in to the account you just created. The token will be an alphanumeric string and should be trated like a password (…because it is). Make note of it, and keep it safe!</li>
</ol>
</div>
<div class="section" id="editing-the-config-file">
<h2>Editing the config file<a class="headerlink" href="#editing-the-config-file" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Find addserver options in the server section of the config file. Remove the sample servers listed and add the following line in their place, replacing the alphanumeric string after ‘oauth:’ with the token you created when registering with Twitch in the previous section. Pretending your Twitch token from the previous step is ‘j9irk4vs28b0obz9easys4w2ystji3u’, it should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">addserver</span> <span class="n">irc</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">twitch</span><span class="o">.</span><span class="n">tv</span> <span class="mi">6667</span> <span class="n">oauth</span><span class="p">:</span><span class="n">j9irk4vs28b0obz9easys4w2ystji3u</span>
</pre></div>
</div>
</li>
</ol>
<p>Make sure you leave the ‘oauth:’ there, including the ‘:’.</p>
<ol class="arabic" start="2">
<li><p class="first">Find <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">cap-request</span></code> setting in the CAP section of the config file. We want to negotiate the ability to use Twitch-specific capabilities with the server, so edit that line so it looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">cap</span><span class="o">-</span><span class="n">request</span> <span class="s2">&quot;twitch.tv/commands twitch.tv/membership twitch.tv/tags&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Find the keep-nick setting below the CAP section of the config file, and set it to 0.</p>
</li>
<li><p class="first">Find the Twitch section of the config file, and enable the loading of the twitch module by removing the ‘#’ in front of the loadmodule command. It should look like this when you are done:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">loadmodule</span> <span class="n">twitch</span>
</pre></div>
</div>
</li>
<li><p class="first">Start your bot as usual, and good luck!</p>
</li>
</ol>
</div>
<div class="section" id="twitch-web-ui-functions">
<h2>Twitch web UI functions<a class="headerlink" href="#twitch-web-ui-functions" title="Permalink to this headline">¶</a></h2>
<p>Twitch is normally accessed via a web UI, and uses commands prefixed with a . or a / to interact with the channel. The Twitch module adds the Tcl command <code class="docutils literal notranslate"><span class="pre">twcmd</span></code> to replicate those Twitch-specific commands. For example, to grant VIP status to a user via Tcl, you would use the command <code class="docutils literal notranslate"><span class="pre">twcmd</span> <span class="pre">vip</span> <span class="pre">username</span></code>. or to restrict chat to subscibers, you would use <code class="docutils literal notranslate"><span class="pre">twcmd</span> <span class="pre">subscribers</span></code>. In other words, <code class="docutils literal notranslate"><span class="pre">twcmd</span></code> in Tcl is the interface to the standard Twitch set of commands available through the web UI.</p>
</div>
<div class="section" id="tracking-users-and-status-with-twitch-tcl">
<h2>Tracking users and status with twitch.tcl<a class="headerlink" href="#tracking-users-and-status-with-twitch-tcl" title="Permalink to this headline">¶</a></h2>
<p>IMPORTANT: To use this script, you need to install additional Tcl libraries. On a Debian/Ubuntu-based system, you can do this by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">tcllib</span> <span class="n">tcl</span><span class="o">-</span><span class="n">tls</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Then, configure the section below and load this script by adding::</dt>
<dd>source scripts/twitch.tcl</dd>
</dl>
<p>at the bottom of your Eggdrop’s config file.</p>
<p>Finally, to enable this tracking for a channel, join the partyline of your eggdrop and enable the functionality with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">chanset</span> <span class="c1">#examplechan +twitchusers</span>
</pre></div>
</div>
<p>As mentioned in the <a class="reference internal" href="#disclaimer">Disclaimer</a>, the API used for this is developed and maintained by Twitch (not Eggdrop!) but is undocumented and not official. As such, we want to be good stewards of this functionality and not be part of the reason it could be taken away, which hundreds of Eggdrops hammering it every minute could do. To that end, we built this script to require manual refreshes of the data as opposed to a scheduled polling of the API. Eggdrop will load this data once when it joins a channel (if you enabled the +twitchusers channel flag via <code class="docutils literal notranslate"><span class="pre">.chanset</span></code> on the partyline), and only again if you call <code class="docutils literal notranslate"><span class="pre">twitch:updateusers</span></code> or one of the is* commands with the update flag specified. In other words- this list of users is should only be considered current immediately after you call it yourself; it will not update on its own.</p>
<p>To get create/update a list of users and their statuses on a channel, use the <code class="docutils literal notranslate"><span class="pre">twitch:updateusers</span> <span class="pre">[#channel]</span></code> command. This will load the <code class="docutils literal notranslate"><span class="pre">$tw</span></code> array with the values obtained from the web API in a dict format. To use these values in a script, use <code class="docutils literal notranslate"><span class="pre">$tw(#channel)</span></code> to view all the users and statuses, and the dict command to grab specific values. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>twitch:updateusers #examplechan
&gt; Updating Twitch user statuses for #examplechan...
putlog $tw(#examplechan)
&gt; _links {} chatter_count 2 chatters {broadcaster examplechan vips {} moderators {harry sally} staff {} admins {} global_mods {} viewers spot}
putlog [dict get $tw(#examplechan) chatters moderators]
&gt; harry sally
</pre></div>
</div>
<p>Note that the $tw array returns a nested dict, so you need multiple args to drill down to the value you want, in this case chatters then moderators.</p>
</div>
<div class="section" id="twitch-irc-limitations">
<h2>Twitch IRC limitations<a class="headerlink" href="#twitch-irc-limitations" title="Permalink to this headline">¶</a></h2>
<p>There are a few things you should know about how Twitch provides service through the IRC gateway that affects how well Eggdrop can function:</p>
<ul class="simple">
<li>Twitch does not broadcast JOINs or PARTs for channels over 1,000 users. This renders tracking users on a channel unreliable.</li>
<li>Twitch does not broadcast MODE changes for moderator status. This (mostly) renders tracking the status of users infeasible.</li>
<li>Twitch stores bans on its servers (and does not accept MODE +b), making the Eggdrop ban list (and exempts/invites) mostly useless</li>
<li>Twitch does not allow clients to issue MODE +o/-o commands, preventing Eggdrop from op’ing users through the traditional method</li>
</ul>
<p>In light of these limitations, Eggdrop developers made an intentional decision to leave some non-compatible capabilities present with the Twitch module, most notably on the Tcl side. For example, if functionality such as the Tcl topic bind were to be removed, already-written scripts that had that feature in them would simply not load, rendering the entire Tcl script useless. By leaving these capabilities in, the hope is that existing Tcl scripts can still be used with Twitch, even if in a degraded capacity. As such, do be careful with the scripts you load as you may face errors you had not encountered before.</p>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
          </div>
          <div role="note" aria-label="source link">
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Eggheads.
      Last updated on Apr 28, 2020.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>