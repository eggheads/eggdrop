<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- $Id: compiling.html,v 1.20 2003/03/24 07:29:20 wcc Exp $ -->

<html>
  <head>
    <title>Eggdrop Documentation: Compiling FAQ</title>
  </head>

  <body>
    <div align="center">
      <p><strong>Compiling FAQ</strong></p>
    </div>
    <hr>

    <p>This FAQ may help you successfully compile Eggdrop. Suggestions are by
    various contributors. If you think something should be added, please send
    an e-mail to <a href="mailto:eggdev@eggheads.org">eggdev@eggheads.org</a>.
    Note that in this document, text between a &#39;&lt;&#39; and a
    &#39;&gt;&#39; should be replaced (without the &#39;&lt;&#39; and
    &#39;&gt;&#39;).</p>

    <p><strong>Contents</strong></p>

    <blockquote>
      <ol>
        <li><a href="#faq1">I get a lot of warnings</a></li>

        <li><a href="#faq2">The bot crashes at startup in
        &quot;net.c/708&quot;, for example</a></li>

        <li><a href="#faq3">There is no Tcl installed on your shell</a></li>

        <li><a href="#faq4">strip terminated with signal 6 (various)</a></li>

        <li><a href="#faq5">&#39;DIR&#39; undeclared (and a whole bunch of
        others) (AIX 4)</a></li>

        <li><a href="#faq6">&#39;fd_set&#39; undeclared (and a whole bunch of
        others) (AIX 4)</a></li>

        <li><a href="#faq7">Unresolved or undefined symbols: ldclose, ldopen,
        ldnshread (AIX 3)</a></li>

        <li><a href="#faq8">Unsatisfied symbols &#39;shl_findsym&#39; and
        &#39;shl_load&#39; (HP-UX 9)</a></li>

        <li><a href="#faq9">The bot doesn&#39;t compile on Ultrix</a></li>

        <li><a href="#faq10">Compile stops at the last minute with &quot;ld
        fatal signal 11&quot;! (Linux)</a></li>

        <li><a href="#faq11">Undefined references in net.o (Sun OS)</a></li>

        <li><a href="#faq12">ld: -ltcl7.4: expected libx.so(.major.minor.xxx)
        (various)</a></li>

        <li><a href="#faq13">I experiance problems starting the configure
        script (AIX/various)</a></li>
      </ol>
    </blockquote>
    <br>

    <p><a name="faq1">1. <strong>I get lots of warnings</strong></a></p>

    <blockquote>
      <p>Warnings do not necessarily mean anything bad. As long as the compile
      completes, there is really nothing to worry about. Generally, we try to
      avoid warnings. We try to fix the warnings we are aware of. If you
      experience warnings, you can let us know by e-mailing
      <a href="mailto:bugs@eggheads.org">bugs@eggheads.org</a>. If you feel
      like fixing them yourself, please do so and send us a patch (as described
      in doc/patch.howto). Thanks.</p>
    </blockquote>

    <p><a name="faq2">2. <strong>The bot crashes at startup in
    &quot;net.c/708&quot;, for example</strong></a></p>

    <blockquote>
      <p>On some non-IA32 systems, the gcc options -O2 and -O3 can cause this.
      We don&#39;t know why this happens, but sometimes it helps to remove
      these flags from the Makefile. To disable them, use:</p>

      <blockquote>
        <p>./configure --disable-cc-optimization</p>
      </blockquote>

      <p>Please e-mail
      <a href="mailto:eggdev@eggheads.org">eggdev@eggheads.org</a> if you know
      why this happens, so we can extend the info here.</p>
    </blockquote>

    <p><a name="faq3">3. <strong>There is no Tcl installed on your
    shell</strong></a></p>

    <blockquote>
      <p>If there really is no Tcl installed on your shell, you can install
      it temporarily in /tmp or your /home. Get the latest version of Tcl from
      <a href="ftp://tcl.activestate.com/pub/tcl/">
      ftp://tcl.activestate.com/pub/tcl/</a>
      and follow the installation steps in its README file. After you&#39;ve
      installed Tcl, you have to make configure detect Tcl. To achieve this,
      do the following:</p>

      <blockquote>
        <ol>
          <li>
            <p>Depending on what shell your using:</p>

            <p>bash/ksh:</p>

            <blockquote>
              <p>export LB_LIBRARY_PATH=&#39;&lt;path to directory containing
              Tcl library&gt;&#39;</p>
            </blockquote>

            <p>csh/tcsh/tclsh:</p>

            <blockquote>
              <p>setenv LB_LIBRARY_PATH &#39;&lt;path to directory containing
              Tcl library&gt;&#39;</p>
            </blockquote>
          </li>

          <li>
            <p>Run the following command from your Eggdrop compilation
            directory (this is all one command):</p>

            <blockquote>
              <p>./configure --with-tclinc=&#39;&lt;full path to tcl.h&gt;&#39;
              --with-tcllib=&#39;&lt;full path to Tcl library&gt;&#39;</p>
            </blockquote>
          </li>

          <li>
            <p>Continue compiling the bot, starting with &#39;make
            config&#39;.</p>
          </li>
        </ol>
      </blockquote>
    </blockquote>

    <p><a name="faq4">4. <strong>strip terminated with signal 6
    (various)</strong></a></p>

    <blockquote>
<pre>
collect2: strip terminated with signal 6 [IOT/Abort trap]
*** Exit 1
Stop.
*** Exit 1
Stop.
</pre>

      <p>You can cut out this problem by not stripping the binary (obviously).
      Edit your Makefile, and change this line from:</p>

      <blockquote>
<pre>
GMAKE = ${MAKE} &#39;CC=gcc&#39; &#39;AWK=awk&#39; &#39;OBJS=${OBJS}&#39; &#39;TCLLIBFN=tcl.a&#39; \
        &#39;CFLAGS=${CFLAGS}&#39; &#39;XREQ=${XREQ}&#39; &#39;XLIBS= -L/usr/local/lib -ltcl -lm&#39; \
        &#39;TCLLIB=${TCLLIB}&#39; &#39;RANLIB=ranlib&#39; &#39;STRIP=-s&#39;
</pre>
      </blockquote>

      <p>To (your lines may differ, but what you are doing is changing
      &#39;STRIP=-s&#39; to &#39;STRIP=&#39;):</p>

      <blockquote>
<pre>
     GMAKE = ${MAKE} &#39;CC=gcc&#39; &#39;AWK=awk&#39; &#39;OBJS=${OBJS}&#39; &#39;TCLLIBFN=tcl.a&#39; \
             &#39;CFLAGS=${CFLAGS}&#39; &#39;XREQ=${XREQ}&#39; &#39;XLIBS= -L/usr/local/lib -ltcl -lm&#39; \
             &#39;TCLLIB=${TCLLIB}&#39; &#39;RANLIB=ranlib&#39; &#39;STRIP=&#39;</p>
</pre>
      </blockquote>

    <p><a name="faq5">5. <strong>&#39;DIR&#39; undeclared (and a whole bunch of
    others) (AIX 4)</strong></a></p>

    <blockquote>
<pre>
gcc -c -O2 -fno-strength-reduce -I.. -DHAVE_CONFIG_H  filedb.c
filedb.c: In function `filedb_update&#39;:
filedb.c:209: `DIR&#39; undeclared (first use this function)
filedb.c:209: (Each undeclared identifier is reported only once
filedb.c:209: for each function it appears in.)
filedb.c:209: `dir&#39; undeclared (first use this function)
filedb.c:209: parse error before `*&#39;
filedb.c:217: warning: assignment makes pointer from integer without a cast
filedb.c:218: `name&#39; undeclared (first use this function)
filedb.c:218: dereferencing pointer to incomplete type
filedb.c:220: dereferencing pointer to incomplete type
filedb.c:220: dereferencing pointer to incomplete type
filedb.c:224: dereferencing pointer to incomplete type
filedb.c:224: dereferencing pointer to incomplete type
filedb.c:225: dereferencing pointer to incomplete type
filedb.c:230: `s&#39; undeclared (first use this function)
filedb.c:231: `st&#39; undeclared (first use this function)
filedb.c:232: `fdb&#39; undeclared (first use this function)
filedb.c:232: `where&#39; undeclared (first use this function)
filedb.c:237: `fdb1&#39; undeclared (first use this function)
filedb.c:253: warning: assignment makes pointer from integer without a cast
make: The error code from the last command is 1.
</pre>

      <p>The configure script didn&#39;t detect that this particular system had
      dirent.h and sys/dir.h. The solution is to add -DHAVE_DIRENT_H
      -DHAVE_SYS_DIR_H to the Makefile&#39;s CFLGS line:</p>

      <blockquote>
<pre>
CFLGS = -DHAVE_DIRENT_H -DHAVE_SYS_DIR_H
</pre>
      </blockquote>
    </blockquote>

    <p><a name="faq6">6. <strong>&#39;DIR&#39; undeclared (and a whole bunch of
    others) (AIX 4)</strong></a></p>

    <blockquote>
<pre>
gcc -c -O2 -fno-strength-reduce -I.. -DHAVE_CONFIG_H -DHAVE_DIRENT_H -DHAVE_SYS_DIR_H net.c
net.c: In function `sockread&#39;:
net.c:390: `fd_set&#39; undeclared (first use this function)
net.c:390: (Each undeclared identifier is reported only once
net.c:390: for each function it appears in.)
net.c:390: parse error before `fd&#39;
net.c:396: `fd&#39; undeclared (first use this function)
make: The error code from the last command is 1.
</pre>

      <p>Again, this seems that one of configure&#39;s components (sed, awk, or
      something along those lines) is broken, and configure failed to detect
      that this system needed sys/select.h. The solution is to add
      -DHAVE_SYS_SELECT_H to the Makefile&#39;s CFLGS line:</p>

      <blockquote>
<pre>
CFLGS = -DHAVE_DIRENT_H -DHAVE_SYS_DIR_H -DHAVE_SYS_SELECT_H
</pre>
      </blockquote>
    </blockquote>

    <p><a name="faq7">7. <strong>Unresolved or undefined symbols: ldclose,
    ldopen, ldnshread (AIX 3)</strong></a></p>

    <blockquote>
<pre>
cc -s -o eggdrop chan.o chanprog.o chanset.o cmds.o dcc.o dccutil.o
filedb.o fileq.o files.o gotdcc.o hash.o main.o match.o mem.o misc.o
mode.o msgcmds.o msgnotice.o net.o tandcmd.o tandem.o tcl.o tclhash.o
userrec.o users.o -L/home2/f/foster/lib -ltcl7.5 -lm
   0706-317 ERROR: Unresolved or undefined symbols detected:
                   Symbols in error (followed by references) are dumped to the load map.
                   The -bloadmap:&lt;filename&gt; option will create a load map.
   .ldclose
   .ldopen
   .ldnshread
   make: 1254-004 The error code from the last command is 8.
</pre>

      <p>Apparently, what is happening is a library called ld is required.
      Either configure doesn&#39;t know it is needed, it simply can&#39;t find
      it, or maybe this is a unique case. The solution is to have ld linked in
      with the final binary.</p>

      <p>Edit your Makefile and find the line that looks something like
      this:</p>

      <blockquote>
<pre>
GMAKE = ${MAKE} &#39;CC=cc&#39; &#39;AWK=awk&#39; &#39;OBJS=${OBJS}&#39; &#39;TCLLIBFN=tcl7.5.a&#39;\
               &#39;CFLAGS=${CFLAGS}&#39; &#39;XREQ=${XREQ}&#39; &#39;XLIBS= -L/home2/f/foster/lib -ltcl7.5 -lm&#39;\
               &#39;TCLLIB=${TCLLIB}&#39; &#39;RANLIB=ranlib&#39; &#39;STRIP=-s&#39;
</pre>
      </blockquote>

      <p>Add in -lld into the XLIBS assignment, like this:</p>

      <blockquote>
<pre>
GMAKE = ${MAKE} &#39;CC=cc&#39; &#39;AWK=awk&#39; &#39;OBJS=${OBJS}&#39; &#39;TCLLIBFN=tcl7.5.a&#39;\
                &#39;CFLAGS=${CFLAGS}&#39; &#39;XREQ=${XREQ}&#39; &#39;XLIBS=-lld -L/home2/f/foster/lib -ltcl7.5 -lm&#39;\
                &#39;TCLLIB=${TCLLIB}&#39; &#39;RANLIB=ranlib&#39; &#39;STRIP=-s&#39;
</pre>
      </blockquote>
    </blockquote>

    <p><a name="faq8">8. <strong>Unsatisfied symbols &#39;shl_findsym&#39; and
    &#39;shl_load&#39; (HP-UX 9)</strong></a></p>

    <blockquote>
<pre>
gcc -s -o eggdrop chan.o chanprog.o chanset.o cmds.o dcc.o
dccutil.o filedb.o fileq.o files.o gotdcc.o hash.o main.o match.o
mem.o misc.o mode.o msgcmds.o msgnotice.o net.o tandcmd.o tandem.o
tcl.o tclhash.o userrec.o users.o -L/home/hltran/tcl/lib -ltcl7.5 -lm
   /bin/ld: Unsatisfied symbols:
      shl_findsym (code)
      shl_load (code)
   collect2: ld returned 1 exit status
   *** Error code 1
   Stop.
</pre>

      <p>Upgrade to a later version of Tcl. The following should also work.</p>

      <p>Edit your Makefile and find the line that looks something like
      this:</p>

      <blockquote>
<pre>
GMAKE = ${MAKE} &#39;CC=gcc&#39; &#39;AWK=awk&#39; &#39;OBJS=${OBJS}&#39; &#39;TCLLIBFN=tcl7.5.a&#39;\
                &#39;CFLAGS=${CFLAGS}&#39; &#39;XREQ=${XREQ}&#39; &#39;XLIBS= -L/usr/local/lib -ltcl7.5 -lm&#39;\
                &#39;TCLLIB=${TCLLIB}&#39; &#39;RANLIB=:&#39; &#39;STRIP=&#39;
</pre>
      </blockquote>

      <p>Add in -lld into the XLIBS assignment, like this:</p>

      <blockquote>
<pre>
GMAKE = ${MAKE} &#39;CC=gcc&#39; &#39;AWK=awk&#39; &#39;OBJS=${OBJS}&#39; &#39;TCLLIBFN=tcl7.5.a&#39;\
                &#39;CFLAGS=${CFLAGS}&#39; &#39;XREQ=${XREQ}&#39; &#39;XLIBS=-lld -L/usr/local/lib -ltcl7.5 -lm&#39;\
                &#39;TCLLIB=${TCLLIB}&#39; &#39;RANLIB=:&#39; &#39;STRIP=&#39;
</pre>
      </blockquote>
    </blockquote>

    <p><a name="faq9">9. <strong>The bot doesn&#39;t compile on
    Ultrix</strong></a></p>

    <blockquote>
      <p>There are some known problems with make and Eggdrop on Ultrix systems.
      Try using gmake instead of make. Additionally, sh5 should be used. A
      simple &#39;gmake SHELL=/bin/sh5&#39; should work.</p>
    </blockquote>

    <p><a name="faq10">10. <strong>Compile stops at the last minute with
    &quot;ld fatal signal 11&quot;! (Linux)</strong></a></p>

    <blockquote>
      <p>This seems to be caused by a non-ELF Tcl library binary, and the
      compiler doesn&#39;t seem to like it. The first thing you want to do is
      download and compile Tcl yourself. Then, follow this set of commands
      commands to help you reconfigure Eggdrop using the newly compiled Tcl
      library (all of this should be done from your home directory):</p>

      <blockquote>
        <ol>
          <li>
            <p>Depending on what shell your using:</p>

            <p>bash/ksh:</p>

            <blockquote>
              <p>export LB_LIBRARY_PATH=&#39;&lt;path to directory containing
              Tcl library&gt;&#39;</p>
            </blockquote>

            <p>csh/tcsh/tclsh:</p>

            <blockquote>
              <p>setenv LB_LIBRARY_PATH &#39;&lt;path to directory containing
              Tcl library&gt;&#39;</p>
            </blockquote>
          </li>

          <li>
            <p>Run the following command from your Eggdrop compilation
            directory (this is all one command):</p>

            <blockquote>
              <p>./configure --with-tclinc=&#39;&lt;full path to tcl.h&gt;&#39;
              --with-tcllib=&#39;&lt;full path to Tcl library&gt;&#39;</p>
            </blockquote>
          </li>

          <li>
            <p>Continue compiling the bot, starting with &#39;make
            config&#39;.</p>
          </li>
        </ol>
      </blockquote>
    </blockquote>

    <p><a name="faq11">11. <strong>Undefined references in net.o
    (Sun OS)</strong></a></p>

    <blockquote>
<pre>
                   First
    Undefined    Referenced
     Symbol       In file

    socket          net.o
    gethostbyname   net.o
    accept          net.o
    bind            net.o
    setsockopt      net.o
    gethostbyaddr   net.o
    getsockname     net.o
    gethostname     net.o
    listen          net.o
    connect         net.o
    ld: fatal: Symbol referencing errors. No output written to eggdrop
</pre>

      <p>This seems to be caused by a few libraries not being detected by the
      auto-configure script; it is relatively easy to fix. Edit your Makefile.
      Note that yours may be slightly different than this one when it comes to
      the Tcl library, but here is the way it probably is:</p>

      <blockquote>
<pre>
GMAKE = ${MAKE} &#39;CC=gcc&#39; &#39;AWK=awk&#39; &#39;OBJS=${OBJS}&#39; &#39;TCLLIBFN=tcl.a&#39;\
        &#39;CFLAGS=${CFLAGS}&#39; &#39;XREQ=${XREQ}&#39; &#39;XLIBS= -L/usr/local/lib -ltcl -lm&#39;\
        &#39;TCLLIB=${TCLLIB}&#39; &#39;RANLIB=:&#39; &#39;STRIP=&#39;
</pre>
      </blockquote>

      <p>Here is what you need to change it to:</p>

      <blockquote>
<pre>
GMAKE = ${MAKE} &#39;CC=gcc&#39; &#39;AWK=awk&#39; &#39;OBJS=${OBJS}&#39; &#39;TCLLIBFN=tcl.a&#39;\
        &#39;CFLAGS=${CFLAGS}&#39; &#39;XREQ=${XREQ}&#39; &#39;XLIBS=-lsocket -ldl -lnsl -L/usr/local/lib -ltcl -lm&#39;\
        &#39;TCLLIB=${TCLLIB}&#39; &#39;RANLIB=:&#39; &#39;STRIP=&#39;
</pre>
      </blockquote>

      <p>You are adding three libraries to be linked in: socket, dl, and nsl.
      This will resolve the net.o errors.</p>
    </blockquote>

    <p><a name="faq12">12. <strong>ld: -ltcl7.4: expected
    libx.so(.major.minor.xxx) (various)</strong></a></p>

    <blockquote>
<pre>
ld: -ltcl7.4: expected libx.so(.major.minor.xxx)
collect2: ld returned 4 exit status
*** Error code 1
make: Fatal error: Command failed for target `eggdrop&#39;
</pre>

      <p>On some UNIX boxes, this seems to be caused by the linker. It is
      expecting a specific filename format, and when the filename doesn&#39;t
      live up to its expectations, it usually barfs. I always see this when
      the library for Tcl is called libtcl7.4.a or libtcl7.5.a. If you
      installed Tcl yourself, rename it to libtcl.a. If you didn&#39;t and
      your using the Tcl that the system admin installed, then do the
      following:</p>

      <blockquote>
        <ol>
          <li>
            <p>View your Makefile. Look for the line (should be close to the
            top) that is similar to:</p>

            <blockquote>
<pre>
XREQ = /usr/local/lib/libtcl7.4.a
</pre>
            </blockquote>
          </li>

          <li>
            <p>Remember this path. The next thing you want to do, depending on
            what shell your using, is:</p>

            <p>bash/ksh:</p>

            <blockquote>
              <p>export LB_LIBRARY_PATH=&#39;&lt;path to directory containing
              Tcl library&gt;&#39;</p>
            </blockquote>

            <p>csh/tcsh/tclsh:</p>

            <blockquote>
              <p>setenv LB_LIBRARY_PATH &#39;&lt;path to directory containing
              Tcl library&gt;&#39;</p>
            </blockquote>
          </li>

          <li>
            <p>Run the following command from your Eggdrop compilation
            directory (this is all one command):</p>

            <blockquote>
              <p>./configure --with-tclinc=&#39;&lt;full path to tcl.h&gt;&#39;
              --with-tcllib=&#39;&lt;full path to Tcl library&gt;&#39;</p>
            </blockquote>
          </li>

          <li>
            <p>Continue compiling the bot, starting with &#39;make
            config&#39;.</p>
          </li>
        </ol>
      </blockquote>
    </blockquote>

    <p><a name="faq13">13. <strong>I experiance problems starting the configure
    script (AIX/various)</strong></a></p>

    <blockquote>
      <p>If you receive file descriptor or bad interpreter errors when
      attempting to run the configure script, try running &#39;sh
      configure&#39; or &#39;bash configure&#39; instead of
      &#39;./configure&#39;. This problem seems to show up on many AIX
      machines.</p>
    </blockquote>
    <hr>

    <p><em>Copyright &copy; 1997 Robey Pointer<br>
    Copyright &copy; 1999, 2000, 2001, 2002, 2003
    <a href="http://www.eggheads.org/"> Eggheads Development Team</a></em></p>
  </body>
</html>
